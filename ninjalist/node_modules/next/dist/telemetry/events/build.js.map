{"version":3,"sources":["../../../telemetry/events/build.ts"],"names":["REGEXP_DIRECTORY_DUNDER","REGEXP_DIRECTORY_TESTS","REGEXP_FILE_TEST","EVENT_BUILD_DURATION","eventBuildCompleted","pagePaths","event","eventName","payload","totalPageCount","length","hasDunderPages","some","path","test","hasTestPages","EVENT_BUILD_OPTIMIZE","eventBuildOptimize"],"mappings":"mIAAA,KAAMA,CAAAA,uBAAuB,CAAG,mDAAhC,CACA,KAAMC,CAAAA,sBAAsB,CAAG,8BAA/B,CACA,KAAMC,CAAAA,gBAAgB,CAAG,0BAAzB,CAEA,KAAMC,CAAAA,oBAAoB,CAAG,sBAA7B,CAQO,QAASC,CAAAA,mBAAT,CACLC,SADK,CAELC,KAFK,CAMgD,CACrD,MAAO,CACLC,SAAS,CAAEJ,oBADN,CAELK,OAAO,CAAE,CACP,GAAGF,KADI,CAEPG,cAAc,CAAEJ,SAAS,CAACK,MAFnB,CAGPC,cAAc,CAAEN,SAAS,CAACO,IAAV,CAAgBC,IAAD,EAC7Bb,uBAAuB,CAACc,IAAxB,CAA6BD,IAA7B,CADc,CAHT,CAMPE,YAAY,CAAEV,SAAS,CAACO,IAAV,CACXC,IAAD,EACEZ,sBAAsB,CAACa,IAAvB,CAA4BD,IAA5B,GAAqCX,gBAAgB,CAACY,IAAjB,CAAsBD,IAAtB,CAF3B,CANP,CAFJ,CAAP,CAcD,CAED,KAAMG,CAAAA,oBAAoB,CAAG,sBAA7B,CAiBO,QAASC,CAAAA,kBAAT,CACLZ,SADK,CAELC,KAFK,CAMgD,CACrD,MAAO,CACLC,SAAS,CAAES,oBADN,CAELR,OAAO,CAAE,CACP,GAAGF,KADI,CAEPG,cAAc,CAAEJ,SAAS,CAACK,MAFnB,CAGPC,cAAc,CAAEN,SAAS,CAACO,IAAV,CAAgBC,IAAD,EAC7Bb,uBAAuB,CAACc,IAAxB,CAA6BD,IAA7B,CADc,CAHT,CAMPE,YAAY,CAAEV,SAAS,CAACO,IAAV,CACXC,IAAD,EACEZ,sBAAsB,CAACa,IAAvB,CAA4BD,IAA5B,GAAqCX,gBAAgB,CAACY,IAAjB,CAAsBD,IAAtB,CAF3B,CANP,CAFJ,CAAP,CAcD","sourcesContent":["const REGEXP_DIRECTORY_DUNDER = /[\\\\/]__[^\\\\/]+(?<![\\\\/]__(?:tests|mocks))__[\\\\/]/i\nconst REGEXP_DIRECTORY_TESTS = /[\\\\/]__(tests|mocks)__[\\\\/]/i\nconst REGEXP_FILE_TEST = /\\.(?:spec|test)\\.[^.]+$/i\n\nconst EVENT_BUILD_DURATION = 'NEXT_BUILD_COMPLETED'\ntype EventBuildCompleted = {\n  durationInSeconds: number\n  totalPageCount: number\n  hasDunderPages: boolean\n  hasTestPages: boolean\n}\n\nexport function eventBuildCompleted(\n  pagePaths: string[],\n  event: Omit<\n    EventBuildCompleted,\n    'totalPageCount' | 'hasDunderPages' | 'hasTestPages'\n  >\n): { eventName: string; payload: EventBuildCompleted } {\n  return {\n    eventName: EVENT_BUILD_DURATION,\n    payload: {\n      ...event,\n      totalPageCount: pagePaths.length,\n      hasDunderPages: pagePaths.some((path) =>\n        REGEXP_DIRECTORY_DUNDER.test(path)\n      ),\n      hasTestPages: pagePaths.some(\n        (path) =>\n          REGEXP_DIRECTORY_TESTS.test(path) || REGEXP_FILE_TEST.test(path)\n      ),\n    },\n  }\n}\n\nconst EVENT_BUILD_OPTIMIZE = 'NEXT_BUILD_OPTIMIZED'\ntype EventBuildOptimized = {\n  durationInSeconds: number\n  totalPageCount: number\n  staticPageCount: number\n  staticPropsPageCount: number\n  serverPropsPageCount: number\n  ssrPageCount: number\n  hasDunderPages: boolean\n  hasTestPages: boolean\n  hasStatic404: boolean\n  hasReportWebVitals: boolean\n  headersCount: number\n  rewritesCount: number\n  redirectsCount: number\n}\n\nexport function eventBuildOptimize(\n  pagePaths: string[],\n  event: Omit<\n    EventBuildOptimized,\n    'totalPageCount' | 'hasDunderPages' | 'hasTestPages'\n  >\n): { eventName: string; payload: EventBuildOptimized } {\n  return {\n    eventName: EVENT_BUILD_OPTIMIZE,\n    payload: {\n      ...event,\n      totalPageCount: pagePaths.length,\n      hasDunderPages: pagePaths.some((path) =>\n        REGEXP_DIRECTORY_DUNDER.test(path)\n      ),\n      hasTestPages: pagePaths.some(\n        (path) =>\n          REGEXP_DIRECTORY_TESTS.test(path) || REGEXP_FILE_TEST.test(path)\n      ),\n    },\n  }\n}\n"]}