{"version":3,"sources":["../../../lib/typescript/hasNecessaryDependencies.ts"],"names":["requiredPackages","file","pkg","hasNecessaryDependencies","baseDir","resolutions","Map","missingPackages","filter","p","set","require","resolve","paths","_","length","resolvedTypeScript","get","packagesHuman","map","packagesCli","join","yarnLockFile","path","isYarn","catch","FatalTypeScriptError","chalk","bold","red","cyan"],"mappings":"+FAAA,oDACA,kDACA,0CACA,qDACA,4D,mFAEA,KAAMA,CAAAA,gBAAgB,CAAG,CACvB,CAAEC,IAAI,CAAE,YAAR,CAAsBC,GAAG,CAAE,YAA3B,CADuB,CAEvB,CAAED,IAAI,CAAE,yBAAR,CAAmCC,GAAG,CAAE,cAAxC,CAFuB,CAGvB,CAAED,IAAI,CAAE,wBAAR,CAAkCC,GAAG,CAAE,aAAvC,CAHuB,CAAzB,CAUO,cAAeC,CAAAA,wBAAf,CACLC,OADK,CAE2B,CAChC,GAAIC,CAAAA,WAAW,CAAG,GAAIC,CAAAA,GAAJ,EAAlB,CAEA,KAAMC,CAAAA,eAAe,CAAGP,gBAAgB,CAACQ,MAAjB,CAAyBC,CAAD,EAAO,CACrD,GAAI,CACFJ,WAAW,CAACK,GAAZ,CAAgBD,CAAC,CAACP,GAAlB,CAAuBS,OAAO,CAACC,OAAR,CAAgBH,CAAC,CAACR,IAAlB,CAAwB,CAAEY,KAAK,CAAE,CAACT,OAAD,CAAT,CAAxB,CAAvB,EACA,MAAO,MAAP,CACD,CAAC,MAAOU,CAAP,CAAU,CACV,MAAO,KAAP,CACD,CACF,CAPuB,CAAxB,CASA,GAAIP,eAAe,CAACQ,MAAhB,CAAyB,CAA7B,CAAgC,CAC9B,MAAO,CAAEC,kBAAkB,CAAEX,WAAW,CAACY,GAAZ,CAAgB,YAAhB,CAAtB,CAAP,CACD,CAED,KAAMC,CAAAA,aAAa,CAAG,wCAAmBX,eAAe,CAACY,GAAhB,CAAqBV,CAAD,EAAOA,CAAC,CAACP,GAA7B,CAAnB,CAAtB,CACA,KAAMkB,CAAAA,WAAW,CAAGb,eAAe,CAACY,GAAhB,CAAqBV,CAAD,EAAOA,CAAC,CAACP,GAA7B,EAAkCmB,IAAlC,CAAuC,GAAvC,CAApB,CAEA,KAAMC,CAAAA,YAAY,CAAGC,cAAKF,IAAL,CAAUjB,OAAV,CAAmB,WAAnB,CAArB,CACA,KAAMoB,CAAAA,MAAM,CAAG,KAAM,2BAAWF,YAAX,EAAyBG,KAAzB,CAA+B,IAAM,KAArC,CAArB,CAEA,KAAM,IAAIC,2CAAJ,CACJC,eAAMC,IAAN,CAAWC,GAAX,CACG,kGADH,EAGE,MAHF,CAIEF,eAAMC,IAAN,CAAY,kBAAiBD,eAAMC,IAAN,CAAWV,aAAX,CAA0B,cAAvD,CAJF,CAKE,MALF,CAMG,KAAIS,eAAMC,IAAN,CAAWE,IAAX,CACH,CAACN,MAAM,CAAG,gBAAH,CAAsB,wBAA7B,EACE,GADF,CAEEJ,WAHC,CAIH,EAVJ,CAWE,MAXF,CAYEO,eAAMC,IAAN,CACE,8DACED,eAAMG,IAAN,CAAW,eAAX,CADF,CAEE,kFAHJ,CAZF,CAiBE,IAlBE,CAAN,CAoBD","sourcesContent":["import chalk from 'chalk'\nimport path from 'path'\nimport { fileExists } from '../file-exists'\nimport { getOxfordCommaList } from '../oxford-comma-list'\nimport { FatalTypeScriptError } from './FatalTypeScriptError'\n\nconst requiredPackages = [\n  { file: 'typescript', pkg: 'typescript' },\n  { file: '@types/react/index.d.ts', pkg: '@types/react' },\n  { file: '@types/node/index.d.ts', pkg: '@types/node' },\n]\n\nexport type NecessaryDependencies = {\n  resolvedTypeScript: string\n}\n\nexport async function hasNecessaryDependencies(\n  baseDir: string\n): Promise<NecessaryDependencies> {\n  let resolutions = new Map<string, string>()\n\n  const missingPackages = requiredPackages.filter((p) => {\n    try {\n      resolutions.set(p.pkg, require.resolve(p.file, { paths: [baseDir] }))\n      return false\n    } catch (_) {\n      return true\n    }\n  })\n\n  if (missingPackages.length < 1) {\n    return { resolvedTypeScript: resolutions.get('typescript')! }\n  }\n\n  const packagesHuman = getOxfordCommaList(missingPackages.map((p) => p.pkg))\n  const packagesCli = missingPackages.map((p) => p.pkg).join(' ')\n\n  const yarnLockFile = path.join(baseDir, 'yarn.lock')\n  const isYarn = await fileExists(yarnLockFile).catch(() => false)\n\n  throw new FatalTypeScriptError(\n    chalk.bold.red(\n      `It looks like you're trying to use TypeScript but do not have the required package(s) installed.`\n    ) +\n      '\\n\\n' +\n      chalk.bold(`Please install ${chalk.bold(packagesHuman)} by running:`) +\n      '\\n\\n' +\n      `\\t${chalk.bold.cyan(\n        (isYarn ? 'yarn add --dev' : 'npm install --save-dev') +\n          ' ' +\n          packagesCli\n      )}` +\n      '\\n\\n' +\n      chalk.bold(\n        'If you are not trying to use TypeScript, please remove the ' +\n          chalk.cyan('tsconfig.json') +\n          ' file from your package root (and any TypeScript files in your pages directory).'\n      ) +\n      '\\n'\n  )\n}\n"]}