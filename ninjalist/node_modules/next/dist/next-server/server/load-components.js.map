{"version":3,"sources":["../../../next-server/server/load-components.ts"],"names":["interopDefault","mod","default","loadComponents","distDir","pathname","serverless","Component","getStaticProps","getStaticPaths","getServerSideProps","pageConfig","config","DocumentMod","AppMod","ComponentMod","Promise","all","buildManifest","reactLoadableManifest","Document","App","require","BUILD_MANIFEST","REACT_LOADABLE_MANIFEST"],"mappings":"iHAAA,2CACA,0BACA,kCAUO,QAASA,CAAAA,cAAT,CAAwBC,GAAxB,CAAkC,CACvC,MAAOA,CAAAA,GAAG,CAACC,OAAJ,EAAeD,GAAtB,CACD,CAsBM,cAAeE,CAAAA,cAAf,CACLC,OADK,CAELC,QAFK,CAGLC,UAHK,CAI8B,CACnC,GAAIA,UAAJ,CAAgB,CACd,KAAMC,CAAAA,SAAS,CAAG,KAAM,yBAAYF,QAAZ,CAAsBD,OAAtB,CAA+BE,UAA/B,CAAxB,CACA,GAAI,CAAEE,cAAF,CAAkBC,cAAlB,CAAkCC,kBAAlC,EAAyDH,SAA7D,CAEAC,cAAc,CAAG,KAAMA,CAAAA,cAAvB,CACAC,cAAc,CAAG,KAAMA,CAAAA,cAAvB,CACAC,kBAAkB,CAAG,KAAMA,CAAAA,kBAA3B,CACA,KAAMC,CAAAA,UAAU,CAAG,CAAC,KAAMJ,CAAAA,SAAS,CAACK,MAAjB,GAA4B,EAA/C,CAEA,MAAO,CACLL,SADK,CAELI,UAFK,CAGLH,cAHK,CAILC,cAJK,CAKLC,kBALK,CAAP,CAOD,CAED,KAAM,CAACG,WAAD,CAAcC,MAAd,CAAsBC,YAAtB,EAAsC,KAAMC,CAAAA,OAAO,CAACC,GAAR,CAAY,CAC5D,yBAAY,YAAZ,CAA0Bb,OAA1B,CAAmCE,UAAnC,CAD4D,CAE5D,yBAAY,OAAZ,CAAqBF,OAArB,CAA8BE,UAA9B,CAF4D,CAG5D,yBAAYD,QAAZ,CAAsBD,OAAtB,CAA+BE,UAA/B,CAH4D,CAAZ,CAAlD,CAMA,KAAM,CACJY,aADI,CAEJC,qBAFI,CAGJZ,SAHI,CAIJa,QAJI,CAKJC,GALI,EAMF,KAAML,CAAAA,OAAO,CAACC,GAAR,CAAY,CACpBK,OAAO,CAAC,eAAKlB,OAAL,CAAcmB,yBAAd,CAAD,CADa,CAEpBD,OAAO,CAAC,eAAKlB,OAAL,CAAcoB,kCAAd,CAAD,CAFa,CAGpBxB,cAAc,CAACe,YAAD,CAHM,CAIpBf,cAAc,CAACa,WAAD,CAJM,CAKpBb,cAAc,CAACc,MAAD,CALM,CAAZ,CANV,CAcA,KAAM,CAAEJ,kBAAF,CAAsBF,cAAtB,CAAsCC,cAAtC,EAAyDM,YAA/D,CAEA,MAAO,CACLM,GADK,CAELD,QAFK,CAGLb,SAHK,CAILW,aAJK,CAKLC,qBALK,CAMLR,UAAU,CAAEI,YAAY,CAACH,MAAb,EAAuB,EAN9B,CAOLF,kBAPK,CAQLF,cARK,CASLC,cATK,CAAP,CAWD","sourcesContent":["import { BUILD_MANIFEST, REACT_LOADABLE_MANIFEST } from '../lib/constants'\nimport { join } from 'path'\nimport { requirePage } from './require'\nimport { BuildManifest } from './get-page-files'\nimport { AppType, DocumentType } from '../lib/utils'\nimport {\n  PageConfig,\n  GetStaticPaths,\n  GetServerSideProps,\n  GetStaticProps,\n} from 'next/types'\n\nexport function interopDefault(mod: any) {\n  return mod.default || mod\n}\n\nexport type ManifestItem = {\n  id: number | string\n  name: string\n  file: string\n}\n\ntype ReactLoadableManifest = { [moduleId: string]: ManifestItem[] }\n\nexport type LoadComponentsReturnType = {\n  Component: React.ComponentType\n  pageConfig?: PageConfig\n  buildManifest: BuildManifest\n  reactLoadableManifest: ReactLoadableManifest\n  Document: DocumentType\n  App: AppType\n  getStaticProps?: GetStaticProps\n  getStaticPaths?: GetStaticPaths\n  getServerSideProps?: GetServerSideProps\n}\n\nexport async function loadComponents(\n  distDir: string,\n  pathname: string,\n  serverless: boolean\n): Promise<LoadComponentsReturnType> {\n  if (serverless) {\n    const Component = await requirePage(pathname, distDir, serverless)\n    let { getStaticProps, getStaticPaths, getServerSideProps } = Component\n\n    getStaticProps = await getStaticProps\n    getStaticPaths = await getStaticPaths\n    getServerSideProps = await getServerSideProps\n    const pageConfig = (await Component.config) || {}\n\n    return {\n      Component,\n      pageConfig,\n      getStaticProps,\n      getStaticPaths,\n      getServerSideProps,\n    } as LoadComponentsReturnType\n  }\n\n  const [DocumentMod, AppMod, ComponentMod] = await Promise.all([\n    requirePage('/_document', distDir, serverless),\n    requirePage('/_app', distDir, serverless),\n    requirePage(pathname, distDir, serverless),\n  ])\n\n  const [\n    buildManifest,\n    reactLoadableManifest,\n    Component,\n    Document,\n    App,\n  ] = await Promise.all([\n    require(join(distDir, BUILD_MANIFEST)),\n    require(join(distDir, REACT_LOADABLE_MANIFEST)),\n    interopDefault(ComponentMod),\n    interopDefault(DocumentMod),\n    interopDefault(AppMod),\n  ])\n\n  const { getServerSideProps, getStaticProps, getStaticPaths } = ComponentMod\n\n  return {\n    App,\n    Document,\n    Component,\n    buildManifest,\n    reactLoadableManifest,\n    pageConfig: ComponentMod.config || {},\n    getServerSideProps,\n    getStaticProps,\n    getStaticPaths,\n  }\n}\n"]}