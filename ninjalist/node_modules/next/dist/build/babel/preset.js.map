{"version":3,"sources":["../../../build/babel/preset.ts"],"names":["isLoadIntentTest","process","env","NODE_ENV","isLoadIntentDevelopment","styledJsxOptions","options","Array","isArray","plugins","map","plugin","name","pluginOptions","require","resolve","supportsStaticESM","caller","module","exports","api","supportsESM","isServer","isCallerDevelopment","isDev","isTest","isDevelopment","isProduction","isBabelLoader","useJsxRuntime","runtime","Boolean","hasJsxRuntime","isLaxModern","targets","esmodules","presetEnvConfig","modules","exclude","include","node","customModernPreset","sourceType","presets","development","pragma","allowNamespaces","importAs","property","lib","useBuiltIns","corejs","helpers","regenerator","useESModules","absoluteRuntime","undefined","removeImport","filter"],"mappings":"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","sourcesContent":["import { PluginItem } from 'next/dist/compiled/babel/core'\nimport { dirname } from 'path'\n\nconst isLoadIntentTest = process.env.NODE_ENV === 'test'\nconst isLoadIntentDevelopment = process.env.NODE_ENV === 'development'\n\ntype StyledJsxPlugin = [string, any] | string\ntype StyledJsxBabelOptions =\n  | {\n      plugins?: StyledJsxPlugin[]\n      'babel-test'?: boolean\n    }\n  | undefined\n\n// Resolve styled-jsx plugins\nfunction styledJsxOptions(options: StyledJsxBabelOptions) {\n  if (!options) {\n    return {}\n  }\n\n  if (!Array.isArray(options.plugins)) {\n    return options\n  }\n\n  options.plugins = options.plugins.map(\n    (plugin: StyledJsxPlugin): StyledJsxPlugin => {\n      if (Array.isArray(plugin)) {\n        const [name, pluginOptions] = plugin\n        return [require.resolve(name), pluginOptions]\n      }\n\n      return require.resolve(plugin)\n    }\n  )\n\n  return options\n}\n\ntype NextBabelPresetOptions = {\n  'preset-env'?: any\n  'preset-react'?: any\n  'class-properties'?: any\n  'transform-runtime'?: any\n  'experimental-modern-preset'?: PluginItem\n  'styled-jsx'?: StyledJsxBabelOptions\n  'preset-typescript'?: any\n}\n\ntype BabelPreset = {\n  presets?: PluginItem[] | null\n  plugins?: PluginItem[] | null\n  sourceType?: 'script' | 'module' | 'unambiguous'\n  overrides?: Array<{ test: RegExp } & Omit<BabelPreset, 'overrides'>>\n}\n\n// Taken from https://github.com/babel/babel/commit/d60c5e1736543a6eac4b549553e107a9ba967051#diff-b4beead8ad9195361b4537601cc22532R158\nfunction supportsStaticESM(caller: any): boolean {\n  return !!caller?.supportsStaticESM\n}\n\nmodule.exports = (\n  api: any,\n  options: NextBabelPresetOptions = {}\n): BabelPreset => {\n  const supportsESM = api.caller(supportsStaticESM)\n  const isServer = api.caller((caller: any) => !!caller && caller.isServer)\n  const isCallerDevelopment = api.caller((caller: any) => caller?.isDev)\n\n  // Look at external intent if used without a caller (e.g. via Jest):\n  const isTest = isCallerDevelopment == null && isLoadIntentTest\n\n  // Look at external intent if used without a caller (e.g. Storybook):\n  const isDevelopment =\n    isCallerDevelopment === true ||\n    (isCallerDevelopment == null && isLoadIntentDevelopment)\n\n  // Default to production mode if not `test` nor `development`:\n  const isProduction = !(isTest || isDevelopment)\n\n  const isBabelLoader = api.caller(\n    (caller: any) => !!caller && caller.name === 'babel-loader'\n  )\n\n  const useJsxRuntime =\n    options['preset-react']?.runtime === 'automatic' ||\n    (Boolean(api.caller((caller: any) => !!caller && caller.hasJsxRuntime)) &&\n      options['preset-react']?.runtime !== 'classic')\n\n  const isLaxModern =\n    options['preset-env']?.targets &&\n    options['preset-env'].targets.esmodules === true\n\n  const presetEnvConfig = {\n    // In the test environment `modules` is often needed to be set to true, babel figures that out by itself using the `'auto'` option\n    // In production/development this option is set to `false` so that webpack can handle import/export with tree-shaking\n    modules: 'auto',\n    exclude: ['transform-typeof-symbol'],\n    include: [\n      '@babel/plugin-proposal-optional-chaining',\n      '@babel/plugin-proposal-nullish-coalescing-operator',\n    ],\n    ...options['preset-env'],\n  }\n\n  // When transpiling for the server or tests, target the current Node version\n  // if not explicitly specified:\n  if (\n    (isServer || isTest) &&\n    (!presetEnvConfig.targets ||\n      !(\n        typeof presetEnvConfig.targets === 'object' &&\n        'node' in presetEnvConfig.targets\n      ))\n  ) {\n    presetEnvConfig.targets = {\n      // Targets the current process' version of Node. This requires apps be\n      // built and deployed on the same version of Node.\n      node: 'current',\n    }\n  }\n\n  // specify a preset to use instead of @babel/preset-env\n  const customModernPreset =\n    isLaxModern && options['experimental-modern-preset']\n\n  return {\n    sourceType: 'unambiguous',\n    presets: [\n      customModernPreset || [\n        require('next/dist/compiled/babel/preset-env'),\n        presetEnvConfig,\n      ],\n      [\n        require('next/dist/compiled/babel/preset-react'),\n        {\n          // This adds @babel/plugin-transform-react-jsx-source and\n          // @babel/plugin-transform-react-jsx-self automatically in development\n          development: isDevelopment || isTest,\n          ...(useJsxRuntime ? { runtime: 'automatic' } : { pragma: '__jsx' }),\n          ...options['preset-react'],\n        },\n      ],\n      [\n        require('next/dist/compiled/babel/preset-typescript'),\n        { allowNamespaces: true, ...options['preset-typescript'] },\n      ],\n    ],\n    plugins: [\n      !useJsxRuntime && [\n        require('./plugins/jsx-pragma'),\n        {\n          // This produces the following injected import for modules containing JSX:\n          //   import React from 'react';\n          //   var __jsx = React.createElement;\n          module: 'react',\n          importAs: 'React',\n          pragma: '__jsx',\n          property: 'createElement',\n        },\n      ],\n      [\n        require('./plugins/optimize-hook-destructuring'),\n        {\n          // only optimize hook functions imported from React/Preact\n          lib: true,\n        },\n      ],\n      require('next/dist/compiled/babel/plugin-syntax-dynamic-import'),\n      require('./plugins/react-loadable-plugin'),\n      [\n        require('next/dist/compiled/babel/plugin-proposal-class-properties'),\n        options['class-properties'] || {},\n      ],\n      [\n        require('next/dist/compiled/babel/plugin-proposal-object-rest-spread'),\n        {\n          useBuiltIns: true,\n        },\n      ],\n      !isServer && [\n        require('next/dist/compiled/babel/plugin-transform-runtime'),\n        {\n          corejs: false,\n          helpers: true,\n          regenerator: true,\n          useESModules: supportsESM && presetEnvConfig.modules !== 'commonjs',\n          absoluteRuntime: isBabelLoader\n            ? dirname(require.resolve('@babel/runtime/package.json'))\n            : undefined,\n          ...options['transform-runtime'],\n        },\n      ],\n      [\n        isTest && options['styled-jsx'] && options['styled-jsx']['babel-test']\n          ? require('styled-jsx/babel-test')\n          : require('styled-jsx/babel'),\n        styledJsxOptions(options['styled-jsx']),\n      ],\n      require('./plugins/amp-attributes'),\n      isProduction && [\n        require('next/dist/compiled/babel/plugin-transform-react-remove-prop-types'),\n        {\n          removeImport: true,\n        },\n      ],\n      isServer && require('next/dist/compiled/babel/plugin-syntax-bigint'),\n      // Always compile numeric separator because the resulting number is\n      // smaller.\n      require('next/dist/compiled/babel/plugin-proposal-numeric-separator'),\n      require('next/dist/compiled/babel/plugin-proposal-export-namespace-from'),\n    ].filter(Boolean),\n  }\n}\n"]}