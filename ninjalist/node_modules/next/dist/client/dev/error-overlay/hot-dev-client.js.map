{"version":3,"sources":["../../../../client/dev/error-overlay/hot-dev-client.js"],"names":["hadRuntimeError","customHmrEventHandler","connect","options","DevOverlay","register","addMessageListener","event","data","processMessage","ex","console","warn","subscribeToHmrEvent","handler","onUnrecoverableError","isFirstCompilation","mostRecentCompilationHash","hasCompileErrors","clearOutdatedErrors","clear","handleSuccess","isHotUpdate","tryApplyUpdates","onSuccessfulHotUpdate","hasUpdates","onFastRefresh","handleWarnings","warnings","printWarnings","formatted","errors","i","length","handleErrors","onBuildError","error","process","env","__NEXT_TEST_MODE","self","__NEXT_HMR_CB","onBuildOk","onRefresh","log","handleAvailableHash","hash","e","obj","JSON","parse","action","hasErrors","Boolean","hasWarnings","isUpdateAvailable","__webpack_hash__","canApplyUpdates","module","hot","status","afterApplyUpdates","fn","removeStatusHandler","addStatusHandler","onHotUpdateSuccess","handleApplyUpdates","err","updatedModules","window","location","reload","undefined","check","then"],"mappings":"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","sourcesContent":["/**\n * MIT License\n *\n * Copyright (c) 2013-present, Facebook, Inc.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\n// This file is a modified version of the Create React App HMR dev client that\n// can be found here:\n// https://github.com/facebook/create-react-app/blob/v3.4.1/packages/react-dev-utils/webpackHotDevClient.js\n\nimport * as DevOverlay from '@next/react-dev-overlay/lib/client'\nimport stripAnsi from 'next/dist/compiled/strip-ansi'\nimport { getEventSourceWrapper } from './eventsource'\nimport formatWebpackMessages from './format-webpack-messages'\n\n// This alternative WebpackDevServer combines the functionality of:\n// https://github.com/webpack/webpack-dev-server/blob/webpack-1/client/index.js\n// https://github.com/webpack/webpack/blob/webpack-1/hot/dev-server.js\n\n// It only supports their simplest configuration (hot updates on same server).\n// It makes some opinionated choices on top, like adding a syntax error overlay\n// that looks similar to our console output. The error overlay is inspired by:\n// https://github.com/glenjamin/webpack-hot-middleware\n\nlet hadRuntimeError = false\nlet customHmrEventHandler\nexport default function connect(options) {\n  DevOverlay.register()\n\n  getEventSourceWrapper(options).addMessageListener((event) => {\n    // This is the heartbeat event\n    if (event.data === '\\uD83D\\uDC93') {\n      return\n    }\n    try {\n      processMessage(event)\n    } catch (ex) {\n      console.warn('Invalid HMR message: ' + event.data + '\\n' + ex)\n    }\n  })\n\n  return {\n    subscribeToHmrEvent(handler) {\n      customHmrEventHandler = handler\n    },\n    onUnrecoverableError() {\n      hadRuntimeError = true\n    },\n  }\n}\n\n// Remember some state related to hot module replacement.\nvar isFirstCompilation = true\nvar mostRecentCompilationHash = null\nvar hasCompileErrors = false\n\nfunction clearOutdatedErrors() {\n  // Clean up outdated compile errors, if any.\n  if (typeof console !== 'undefined' && typeof console.clear === 'function') {\n    if (hasCompileErrors) {\n      console.clear()\n    }\n  }\n}\n\n// Successful compilation.\nfunction handleSuccess() {\n  clearOutdatedErrors()\n\n  const isHotUpdate = !isFirstCompilation\n  isFirstCompilation = false\n  hasCompileErrors = false\n\n  // Attempt to apply hot updates or reload.\n  if (isHotUpdate) {\n    tryApplyUpdates(function onSuccessfulHotUpdate(hasUpdates) {\n      // Only dismiss it when we're sure it's a hot update.\n      // Otherwise it would flicker right before the reload.\n      onFastRefresh(hasUpdates)\n    })\n  }\n}\n\n// Compilation with warnings (e.g. ESLint).\nfunction handleWarnings(warnings) {\n  clearOutdatedErrors()\n\n  const isHotUpdate = !isFirstCompilation\n  isFirstCompilation = false\n  hasCompileErrors = false\n\n  function printWarnings() {\n    // Print warnings to the console.\n    const formatted = formatWebpackMessages({\n      warnings: warnings,\n      errors: [],\n    })\n\n    if (typeof console !== 'undefined' && typeof console.warn === 'function') {\n      for (let i = 0; i < formatted.warnings.length; i++) {\n        if (i === 5) {\n          console.warn(\n            'There were more warnings in other files.\\n' +\n              'You can find a complete log in the terminal.'\n          )\n          break\n        }\n        console.warn(stripAnsi(formatted.warnings[i]))\n      }\n    }\n  }\n\n  printWarnings()\n\n  // Attempt to apply hot updates or reload.\n  if (isHotUpdate) {\n    tryApplyUpdates(function onSuccessfulHotUpdate(hasUpdates) {\n      // Only dismiss it when we're sure it's a hot update.\n      // Otherwise it would flicker right before the reload.\n      onFastRefresh(hasUpdates)\n    })\n  }\n}\n\n// Compilation with errors (e.g. syntax error or missing modules).\nfunction handleErrors(errors) {\n  clearOutdatedErrors()\n\n  isFirstCompilation = false\n  hasCompileErrors = true\n\n  // \"Massage\" webpack messages.\n  var formatted = formatWebpackMessages({\n    errors: errors,\n    warnings: [],\n  })\n\n  // Only show the first error.\n  DevOverlay.onBuildError(formatted.errors[0])\n\n  // Also log them to the console.\n  if (typeof console !== 'undefined' && typeof console.error === 'function') {\n    for (var i = 0; i < formatted.errors.length; i++) {\n      console.error(stripAnsi(formatted.errors[i]))\n    }\n  }\n\n  // Do not attempt to reload now.\n  // We will reload on next success instead.\n  if (process.env.__NEXT_TEST_MODE) {\n    if (self.__NEXT_HMR_CB) {\n      self.__NEXT_HMR_CB(formatted.errors[0])\n      self.__NEXT_HMR_CB = null\n    }\n  }\n}\n\nfunction onFastRefresh(hasUpdates) {\n  DevOverlay.onBuildOk()\n  if (hasUpdates) {\n    DevOverlay.onRefresh()\n  }\n\n  console.log('[Fast Refresh] done')\n}\n\n// There is a newer version of the code available.\nfunction handleAvailableHash(hash) {\n  // Update last known compilation hash.\n  mostRecentCompilationHash = hash\n}\n\n// Handle messages from the server.\nfunction processMessage(e) {\n  const obj = JSON.parse(e.data)\n  switch (obj.action) {\n    case 'building': {\n      console.log('[Fast Refresh] rebuilding')\n      break\n    }\n    case 'built':\n    case 'sync': {\n      if (obj.hash) {\n        handleAvailableHash(obj.hash)\n      }\n\n      const { errors, warnings } = obj\n      const hasErrors = Boolean(errors && errors.length)\n      if (hasErrors) {\n        return handleErrors(errors)\n      }\n\n      const hasWarnings = Boolean(warnings && warnings.length)\n      if (hasWarnings) {\n        return handleWarnings(warnings)\n      }\n\n      return handleSuccess()\n    }\n    default: {\n      if (customHmrEventHandler) {\n        customHmrEventHandler(obj)\n        break\n      }\n      break\n    }\n  }\n}\n\n// Is there a newer version of this code available?\nfunction isUpdateAvailable() {\n  /* globals __webpack_hash__ */\n  // __webpack_hash__ is the hash of the current compilation.\n  // It's a global variable injected by Webpack.\n  return mostRecentCompilationHash !== __webpack_hash__\n}\n\n// Webpack disallows updates in other states.\nfunction canApplyUpdates() {\n  return module.hot.status() === 'idle'\n}\nfunction afterApplyUpdates(fn) {\n  if (canApplyUpdates()) {\n    fn()\n  } else {\n    function handler(status) {\n      if (status === 'idle') {\n        module.hot.removeStatusHandler(handler)\n        fn()\n      }\n    }\n    module.hot.addStatusHandler(handler)\n  }\n}\n\n// Attempt to update code on the fly, fall back to a hard reload.\nfunction tryApplyUpdates(onHotUpdateSuccess) {\n  if (!module.hot) {\n    // HotModuleReplacementPlugin is not in Webpack configuration.\n    console.error('HotModuleReplacementPlugin is not in Webpack configuration.')\n    // window.location.reload();\n    return\n  }\n\n  if (!isUpdateAvailable() || !canApplyUpdates()) {\n    return\n  }\n\n  function handleApplyUpdates(err, updatedModules) {\n    if (err || hadRuntimeError || !updatedModules) {\n      if (err) {\n        console.warn(\n          '[Fast Refresh] performing full reload\\n\\n' +\n            \"Fast Refresh will perform a full reload when you edit a file that's imported by modules outside of the React rendering tree.\\n\" +\n            'You might have a file which exports a React component but also exports a value that is imported by a non-React component file.\\n' +\n            'Consider migrating the non-React component export to a separate file and importing it into both files.\\n\\n' +\n            'It is also possible the parent component of the component you edited is a class component, which disables Fast Refresh.\\n' +\n            'Fast Refresh requires at least one parent function component in your React tree.'\n        )\n      } else if (hadRuntimeError) {\n        console.warn(\n          '[Fast Refresh] performing full reload because your application had an unrecoverable error'\n        )\n      }\n      window.location.reload()\n      return\n    }\n\n    const hasUpdates = Boolean(updatedModules.length)\n    if (typeof onHotUpdateSuccess === 'function') {\n      // Maybe we want to do something.\n      onHotUpdateSuccess(hasUpdates)\n    }\n\n    if (isUpdateAvailable()) {\n      // While we were updating, there was a new update! Do it again.\n      tryApplyUpdates(hasUpdates ? undefined : onHotUpdateSuccess)\n    } else {\n      if (process.env.__NEXT_TEST_MODE) {\n        afterApplyUpdates(() => {\n          if (self.__NEXT_HMR_CB) {\n            self.__NEXT_HMR_CB()\n            self.__NEXT_HMR_CB = null\n          }\n        })\n      }\n    }\n  }\n\n  // https://webpack.js.org/api/hot-module-replacement/#check\n  module.hot.check(/* autoApply */ true).then(\n    (updatedModules) => {\n      handleApplyUpdates(null, updatedModules)\n    },\n    (err) => {\n      handleApplyUpdates(err, null)\n    }\n  )\n}\n"]}