{"version":3,"sources":["../../cli/next-build.ts"],"names":["nextBuild","argv","validArgs","Boolean","args","error","code","message","Log","warn","dir","_","preflight","getPackageVersion","semver","then","res","default","reactVersion","cwd","name","lt","coerce","version","reactDomVersion","catch","err","console"],"mappings":"AAAA;8DACA,sBACA,8EACA,0BACA,gEAEA,uDACA,0C,w4BAEA,KAAMA,CAAAA,SAAqB,CAAIC,IAAD,EAAU,CACtC,KAAMC,CAAAA,SAAmB,CAAG,CAC1B;AACA,SAAUC,OAFgB,CAG1B,YAAaA,OAHa,CAI1B,UAAWA,OAJe,CAK1B;AACA,KAAM,QANoB,CAO1B,KAAM,SAPoB,CAA5B,CAUA,GAAIC,CAAAA,IAAJ,CACA,GAAI,CACFA,IAAI,CAAG,mBAAIF,SAAJ,CAAe,CAAED,IAAF,CAAf,CAAP,CACD,CAAC,MAAOI,KAAP,CAAc,CACd,GAAIA,KAAK,CAACC,IAAN,GAAe,oBAAnB,CAAyC,CACvC,MAAO,wBAAaD,KAAK,CAACE,OAAnB,CAA4B,CAA5B,CAAP,CACD,CACD,KAAMF,CAAAA,KAAN,CACD,CACD,GAAID,IAAI,CAAC,QAAD,CAAR,CAAoB,CAClB,wBACG;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAbI,CAcE,CAdF,EAgBD,CACD,GAAIA,IAAI,CAAC,WAAD,CAAR,CAAuB,CACrBI,GAAG,CAACC,IAAJ,CAAS,yDAAT,EACD,CACD,KAAMC,CAAAA,GAAG,CAAG,kBAAQN,IAAI,CAACO,CAAL,CAAO,CAAP,GAAa,GAArB,CAAZ,CAEA;AACA,GAAI,CAAC,mBAAWD,GAAX,CAAL,CAAsB,CACpB,wBAAc,mDAAkDA,GAAI,EAApE,EACD,CAED,cAAeE,CAAAA,SAAf,EAA2B,oBACzB,KAAM,CAAEC,iBAAF,EAAwB,iEAAa,4BAAb,GAA9B,CACA,KAAMC,CAAAA,MAAM,CAAG,KAAM,4DAAO,2BAAP,IAAoCC,IAApC,CAClBC,GAAD,EAASA,GAAG,CAACC,OADM,CAArB,CAIA,KAAMC,CAAAA,YAA2B,CAAG,KAAML,CAAAA,iBAAiB,CAAC,CAC1DM,GAAG,CAAET,GADqD,CAE1DU,IAAI,CAAE,OAFoD,CAAD,CAA3D,CAIA,GACEF,YAAY,EACZJ,MAAM,CAACO,EAAP,CAAUH,YAAV,CAAwB,QAAxB,CADA,EAEA,iBAAAJ,MAAM,CAACQ,MAAP,CAAcJ,YAAd,+BAA6BK,OAA7B,IAAyC,OAH3C,CAIE,CACAf,GAAG,CAACC,IAAJ,CACE,iGACE,kDAFJ,EAID,CATD,IASO,qBACL,KAAMe,CAAAA,eAA8B,CAAG,KAAMX,CAAAA,iBAAiB,CAAC,CAC7DM,GAAG,CAAET,GADwD,CAE7DU,IAAI,CAAE,WAFuD,CAAD,CAA9D,CAIA,GACEI,eAAe,EACfV,MAAM,CAACO,EAAP,CAAUG,eAAV,CAA2B,QAA3B,CADA,EAEA,kBAAAV,MAAM,CAACQ,MAAP,CAAcE,eAAd,gCAAgCD,OAAhC,IAA4C,OAH9C,CAIE,CACAf,GAAG,CAACC,IAAJ,CACE,iGACE,kDAFJ,EAID,CACF,CACF,CAED,MAAOG,CAAAA,SAAS,GACbG,IADI,CACC,IAAM,mBAAML,GAAN,CAAW,IAAX,CAAiBN,IAAI,CAAC,WAAD,CAArB,CAAoCA,IAAI,CAAC,SAAD,CAAxC,CADP,EAEJqB,KAFI,CAEGC,GAAD,EAAS,CACdC,OAAO,CAACtB,KAAR,CAAc,EAAd,EACAsB,OAAO,CAACtB,KAAR,CAAc,wBAAd,EACA,wBAAaqB,GAAb,EACD,CANI,CAAP,CAOD,CA5FD,C","sourcesContent":["#!/usr/bin/env node\nimport { existsSync } from 'fs'\nimport arg from 'next/dist/compiled/arg/index.js'\nimport { resolve } from 'path'\nimport * as Log from '../build/output/log'\nimport { cliCommand } from '../bin/next'\nimport build from '../build'\nimport { printAndExit } from '../server/lib/utils'\n\nconst nextBuild: cliCommand = (argv) => {\n  const validArgs: arg.Spec = {\n    // Types\n    '--help': Boolean,\n    '--profile': Boolean,\n    '--debug': Boolean,\n    // Aliases\n    '-h': '--help',\n    '-d': '--debug',\n  }\n\n  let args: arg.Result<arg.Spec>\n  try {\n    args = arg(validArgs, { argv })\n  } catch (error) {\n    if (error.code === 'ARG_UNKNOWN_OPTION') {\n      return printAndExit(error.message, 1)\n    }\n    throw error\n  }\n  if (args['--help']) {\n    printAndExit(\n      `\n      Description\n        Compiles the application for production deployment\n\n      Usage\n        $ next build <dir>\n\n      <dir> represents the directory of the Next.js application.\n      If no directory is provided, the current directory will be used.\n\n      Options\n      --profile     Can be used to enable React Production Profiling\n    `,\n      0\n    )\n  }\n  if (args['--profile']) {\n    Log.warn('Profiling is enabled. Note: This may affect performance')\n  }\n  const dir = resolve(args._[0] || '.')\n\n  // Check if the provided directory exists\n  if (!existsSync(dir)) {\n    printAndExit(`> No such directory exists as the project root: ${dir}`)\n  }\n\n  async function preflight() {\n    const { getPackageVersion } = await import('../lib/get-package-version')\n    const semver = await import('next/dist/compiled/semver').then(\n      (res) => res.default\n    )\n\n    const reactVersion: string | null = await getPackageVersion({\n      cwd: dir,\n      name: 'react',\n    })\n    if (\n      reactVersion &&\n      semver.lt(reactVersion, '17.0.1') &&\n      semver.coerce(reactVersion)?.version !== '0.0.0'\n    ) {\n      Log.warn(\n        'React 17.0.1 or newer will be required to leverage all of the upcoming features in Next.js 11.' +\n          ' Read more: https://err.sh/next.js/react-version'\n      )\n    } else {\n      const reactDomVersion: string | null = await getPackageVersion({\n        cwd: dir,\n        name: 'react-dom',\n      })\n      if (\n        reactDomVersion &&\n        semver.lt(reactDomVersion, '17.0.1') &&\n        semver.coerce(reactDomVersion)?.version !== '0.0.0'\n      ) {\n        Log.warn(\n          'React 17.0.1 or newer will be required to leverage all of the upcoming features in Next.js 11.' +\n            ' Read more: https://err.sh/next.js/react-version'\n        )\n      }\n    }\n  }\n\n  return preflight()\n    .then(() => build(dir, null, args['--profile'], args['--debug']))\n    .catch((err) => {\n      console.error('')\n      console.error('> Build error occurred')\n      printAndExit(err)\n    })\n}\n\nexport { nextBuild }\n"]}